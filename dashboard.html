<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Dashboard</title></head><body>
<div>
  <a href="/logout.html" id="logout">Logout</a>
  <h1>Report</h1>
  <label>datayear <input id="year" placeholder="e.g. 2023"></label>
  <label>county <input id="county" placeholder="e.g. Travis"></label>
  <button id="run">Generate report</button>
  <table id="tbl" border="1" cellspacing="0" cellpadding="6">
    <thead><tr><th>lendername</th><th>count_records</th><th>sum_amount</th></tr></thead>
    <tbody></tbody>
  </table>
</div>
<script>
async function checkSession(){
  const r = await fetch('/api/session'); if(!r.ok){ location.href='/login.html'; }
}
async function run(){
  const y = document.querySelector('#year').value.trim();
  const c = document.querySelector('#county').value.trim();
  const q = new URLSearchParams(); if(y) q.set('year', y); if(c) q.set('county', c);
  const r = await fetch('/api/report?'+q.toString());
  if(!r.ok){ alert('Failed'); return; }
  const data = await r.json();
  const tbody = document.querySelector('#tbl tbody'); tbody.innerHTML='';
  (data.rows||[]).forEach(row=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${row.lendername||''}</td>
      <td style="text-align:right">${row.count_records}</td>
      <td style="text-align:right">${Number(row.sum_amount||0).toLocaleString()}</td>`;
    tbody.appendChild(tr);
  });
}
document.querySelector('#run').addEventListener('click', run);
checkSession();
</script>
</body></html>
